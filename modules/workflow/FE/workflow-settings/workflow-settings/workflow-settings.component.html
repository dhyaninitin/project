<vex-page-layout>
    <vex-page-layout-header class="pb-16 flex flex-col items-start justify-center">
        <div class="w-full flex flex-col sm:flex-row justify-between">
            <div>
                <h1 class="title mt-0 mb-1">Workflow Settings</h1>
                <vex-breadcrumbs [crumbs]="['Workflow Settings']"></vex-breadcrumbs>
            </div>
        </div>
    </vex-page-layout-header>
    <vex-page-layout-content>

        <div class="card -mt-16">
            <div class="head bg-app-bar px-6 h-16 border-b sticky left-0 flex items-center">
                <h2
                    class="title my-0 ltr:pr-4 rtl:pl-4 ltr:mr-4 rtl:ml-4 ltr:border-r rtl:border-l hidden sm:block flex-none">
                    <span>Workflow Settings</span>
                </h2>
            </div>
        </div>
        <div class="flex flex-col md:flex-row">
            <div class="flex-auto">
                <div class="card">

                    <div class="px-gutter py-4 text-center">
                        <mat-card-content class="mt-4">
                            <form [formGroup]="settingsForm">
                                <div class="flex flex-col sm:flex-row">
                                    <div>
                                        <h3>Limit of enrolled objects before authorization  : </h3>
                                    </div>
                                    <mat-form-field class="flex-auto ml-2">
                                        <mat-label> Limit</mat-label>
                                        <input matInput type="number" formControlName="enrollment_number" placeholder="Limit"
                                        min="0" oninput="validity.valid||(value='');"/>
                                    </mat-form-field>
            
                                    <mat-form-field class="sm:ml-6 flex-auto">
                                        <mat-label>Select Users for Verification</mat-label>
                                        <mat-select #portalUsersSelect multiple formControlName="portal_users"
                                        (infiniteScroll)="getNextBatch()"[threshold]="'0.5%'" [debounceTime]="150" [complete]="offset === totalPages" msInfiniteScroll>
                                        <ngx-mat-select-search *ngIf="true" [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' "
                                          [formControl]="userFilterCtrl" [preventHomeEndKeyPropagation]="true">
                                          <mat-icon ngxMatSelectSearchClear>delete</mat-icon>
                                        </ngx-mat-select-search>
                                            <mat-option *ngFor="let user of portalUsers" [value]="user.id">
                                              {{ user?.full_name }}
                                            </mat-option>
                                            <mat-option *ngIf="loading">
                                              <mat-spinner class="input-mat-spinner-loader"
                                              color="primary"
                                              [diameter]="30"></mat-spinner>
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <div class="pb-8 pt-4">
                                    <button mat-raised-button color="primary" type="button" (click)="save()" [disabled]="settingsForm.invalid">Save</button>
                                </div>
                            </form>
                        </mat-card-content>
                    </div>
                </div>
            </div>
        </div>

        
	<div class="mt-6 flex flex-col md:flex-row md:items-start">
		<div class="flex-auto">
			<div class="card">
				<div class="px-gutter py-4 border-b flex justify-content-space-between">
					<h2 class="title m-0">Workflow Setting's History</h2>
				</div>
				<div class="px-gutter">
					<div class="items-center">
						<div class="flex flex-col sm:flex-row justify-content-end mt-4">
							<div
								class="bg-foreground rounded-full border px-4 max-w-[300px] flex-auto flex items-center border border-gray-300">
								<mat-icon class="icon-sm text-secondary" svgIcon="mat:search"></mat-icon>
								<input class="px-4 py-2 border-0 outline-none w-full bg-transparent" placeholder="Search..."
									name="searchLogSource" type="search" [(ngModel)]="logSearch" #searchLogInput
									(ngModelChange)="onClearFilterSearch($event)">
							</div>
						</div>
	
						<div class="flex flex-col mt-3 sm:flex-row">
							<mat-progress-bar *ngIf="(logFetching$ | async)" mode="indeterminate"></mat-progress-bar>
							<ul class="log-ul" *ngIf="logs?.length > 0">
								<li *ngFor="let log of logs" @fadeInUp>
									<span [innerHTML]="log.content"></span>
									{{ formatLogMessage(log.content) }} {{ log.created_at | date:'MM/dd/yyy \'at\'
									hh:mm a'}}
								</li>
							</ul>
						</div>
						<div class="text-center mt-2" *ngIf="(logDidFetch$ | async) && logs?.length == 0">There are
							no workflow setting's history available.</div>
						<div class="flex flex-col sm:flex-row justify-content-end">
							<mat-paginator #paginator [length]="logPagination.length" [pageSize]="logPagination.pageSize"
								[pageIndex]="logPagination.pageIndex" [pageSizeOptions]="[20, 50, 100]"
								[showFirstLastButtons]="true" (page)="onLogPaginateChange($event)">
							</mat-paginator>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
    </vex-page-layout-content>
</vex-page-layout>